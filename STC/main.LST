C51 COMPILER V9.52.0.0   MAIN                                                              05/14/2016 18:42:28 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <STC12C5A60S2.H>
   2          #include "common.h"
   3          #include "1602.h"
   4          #include "uart.h"
   5          #include "DHT11.h"
   6          
   7          #define uchar unsigned char
   8          #define uint unsigned int
   9          #define MOTOR P14
  10          #define LED1 P27
  11          #define LED2 P26
  12          #define BUTTON1 P25
  13          #define BUTTON2 P24
  14          #define BUTTON3 P23
  15          #define BUTTON4 P22
  16          #define buzzer P20
  17          
  18          void Delay500ms()   //@11.0592MHz
  19          {
  20   1        unsigned char i, j, k;
  21   1      
  22   1        i = 22;
  23   1        j = 3;
  24   1        k = 227;
  25   1        do
  26   1        {
  27   2          do
  28   2          {
  29   3            while (--k);
  30   3          } while (--j);
  31   2        } while (--i);
  32   1      }
  33          
  34          void InitLCD ()
  35          {
  36   1        InitLCM();
  37   1        DisplayListChar(0,0," 00:00:00 R 00 O");
  38   1        DisplayListChar(0,1,"Connecting...");
  39   1      }
  40          
  41          void Init_online()
  42          {
  43   1        getflag=1;
  44   1        while(getflag){
  45   2          Uart_One_Send('A');
  46   2          Delay500ms();
  47   2          if(getflag==0)
  48   2            break;
  49   2        }
  50   1      
  51   1      }
  52          
  53          void Senddata()
  54          {
  55   1        Uart_One_Printf("N:");
C51 COMPILER V9.52.0.0   MAIN                                                              05/14/2016 18:42:28 PAGE 2   

  56   1        Uart_One_Send((int)MOTOR+0x30);
  57   1        Uart_One_Send(':');
  58   1        Uart_One_Send(8+0x30);
  59   1        Uart_One_Send(':');
  60   1        Uart_One_Send(U8T_data_H/10+0x30);
  61   1        Uart_One_Send(U8T_data_H%10+0x30);
  62   1        Uart_One_Send(':');
  63   1        Uart_One_Send(U8RH_data_H/10+0x30);
  64   1        Uart_One_Send(U8RH_data_H%10+0x30);
  65   1        Uart_One_Send(':');
  66   1        Uart_One_Send((int)PM/100%10+0x30);
  67   1        Uart_One_Send((int)PM/10%10+0x30);
  68   1        Uart_One_Send((int)PM%10+0x30);
  69   1      }
  70          
  71          void main()
  72          {
  73   1        unsigned int i=0 ;
  74   1        InitLCD();
  75   1        LED1=1;
  76   1        LED2=1;
  77   1        BUTTON1=1;
  78   1        BUTTON2=1;
  79   1        BUTTON3=1;
  80   1        BUTTON4=1;
  81   1        MOTOR=1;
  82   1        CCON=0;          //PCA初始化
  83   1        CL=0;       //PCA的16位计数器低八位
  84   1        CH=0;       //PCA的16位计数器高八位
  85   1        CMOD=0x00; //选择 系统时钟/12 为计数脉冲,则PWM的频率f=sysclk/256/12;
  86   1        CCAP0H=0xA0;  //  占空比控制
  87   1        CCAP0L=0xA0;
  88   1        PCA_PWM0=0x00; //控制占空比的第九位为0
  89   1        CCAPM0=0x42;  //允许P13作为PWM输出
  90   1        CR=1;     //启动PCA计数器
  91   1        Uart_Two_Init();
  92   1        Uart_One_Init();
  93   1        Init_online();
  94   1        DisplayOneChar(15,0,'N');
  95   1        DisplayListChar(0,1,"T=00 H=00 A=000");
  96   1        while(1){
  97   2          for(i=0;i<8;i++)
  98   2            DisplayOneChar(i+1,0,time[i]);
  99   2          if(MOTOR)
 100   2            DisplayOneChar(10,0,'R');
 101   2          else
 102   2            DisplayOneChar(10,0,'S');
 103   2          CCAP0H=MOTOR_SPEED*16;
 104   2          CCAP0L=MOTOR_SPEED*16;
 105   2          DisplayOneChar(12,0,MOTOR_SPEED/10+0x30);
 106   2          DisplayOneChar(13,0,MOTOR_SPEED%10+0x30);
 107   2          RH();
 108   2          DisplayOneChar(2,1,U8T_data_H/10+0x30);
 109   2          DisplayOneChar(3,1,U8T_data_H%10+0x30);
 110   2          DisplayOneChar(7,1,U8RH_data_H/10+0x30);
 111   2          DisplayOneChar(8,1,U8RH_data_H%10+0x30);
 112   2          DisplayOneChar(12,1,(int)PM/100%10+0x30);
 113   2          DisplayOneChar(13,1,(int)PM/10%10+0x30);
 114   2          DisplayOneChar(14,1,(int)PM%10+0x30);
 115   2          if(PM>100.0){
 116   3            MOTOR=1;
 117   3            MOTOR_SPEED=(PM/10)<15?(int)(PM/10):15;
C51 COMPILER V9.52.0.0   MAIN                                                              05/14/2016 18:42:28 PAGE 3   

 118   3          }else if(PM<80.0){
 119   3            MOTOR=0;
 120   3            MOTOR_SPEED=10;
 121   3          }
 122   2          Senddata();
 123   2        }
 124   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    703    ----
   CONSTANT SIZE    =     50    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
