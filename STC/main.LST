C51 COMPILER V9.52.0.0   MAIN                                                              05/14/2016 17:58:59 PAGE 1   


C51 COMPILER V9.52.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          #include <STC12C5A60S2.H>
   2          #include "common.h"
   3          #include "1602.h"
   4          #include "uart.h"
   5          #include "DHT11.h"
   6          
   7          #define uchar unsigned char
   8          #define uint unsigned int
   9          #define MOTOR P14
  10          #define LED1 P27
  11          #define LED2 P26
  12          #define BUTTON1 P25
  13          #define BUTTON2 P24
  14          #define BUTTON3 P23
  15          #define BUTTON4 P22
  16          #define buzzer P20
  17          
  18          void delayms(unsigned int xms)   //å»¶æ—¶å‡½æ•° ï¼Œå»¶æ—¶xms
  19          {
  20   1            unsigned int i , j;
  21   1                for(i = 0; i < xms; i++)
  22   1                    for(j = 0; j < 110; j++);
  23   1      }
  24          void fengming()    //èœ‚é¸£å‡½æ•°ï¼Œè„‰å®½t = 1ms å‘¨æœŸT = 2ms é¢‘çŽ‡f = 0.5khz å®žé™…å‘çŽ°å»¶æ—¶1msçš„æ
             -—¶å€™æ•ˆæžœæœ€å¥½
  25          {
  26   1              buzzer = 0; //ç»™P1.5å£é€ä½Žç”µå¹³
  27   1              delayms(1);   //å»¶æ—¶1ms
  28   1              buzzer = 1;   //ç»™P1.5å£é€é«˜ç”µå¹³
  29   1              delayms(1);   //å»¶æ—¶1ms
  30   1      }
  31          
  32          void Delay500ms()   //@11.0592MHz
  33          {
  34   1        unsigned char i, j, k;
  35   1      
  36   1        i = 22;
  37   1        j = 3;
  38   1        k = 227;
  39   1        do
  40   1        {
  41   2          do
  42   2          {
  43   3            while (--k);
  44   3          } while (--j);
  45   2        } while (--i);
  46   1      }
  47          
  48          void InitLCD ()
  49          {
  50   1        InitLCM();
  51   1        DisplayListChar(0,0," 00:00:00 R 00 O");
  52   1        DisplayListChar(0,1,"Connecting...");
  53   1      }
  54          
C51 COMPILER V9.52.0.0   MAIN                                                              05/14/2016 17:58:59 PAGE 2   

  55          void Init_online()
  56          {
  57   1        getflag=1;
  58   1        while(getflag){
  59   2          Uart_One_Send('A');
  60   2          Delay500ms();
  61   2          if(getflag==0)
  62   2            break;
  63   2        }
  64   1      
  65   1      }
  66          
  67          void Senddata()
  68          {
  69   1        Uart_One_Printf("N:");
  70   1        Uart_One_Send((int)MOTOR+0x30);
  71   1        Uart_One_Send(':');
  72   1        Uart_One_Send(8+0x30);
  73   1        Uart_One_Send(':');
  74   1        Uart_One_Send(U8T_data_H/10+0x30);
  75   1        Uart_One_Send(U8T_data_H%10+0x30);
  76   1        Uart_One_Send(':');
  77   1        Uart_One_Send(U8RH_data_H/10+0x30);
  78   1        Uart_One_Send(U8RH_data_H%10+0x30);
  79   1        Uart_One_Send(':');
  80   1        Uart_One_Send((int)PM/100%10+0x30);
  81   1        Uart_One_Send((int)PM/10%10+0x30);
  82   1        Uart_One_Send((int)PM%10+0x30);
  83   1      }
  84          
  85          void main()
  86          {
  87   1        unsigned int i=0 ;
  88   1        InitLCD();
  89   1        LED1=1;
  90   1        LED2=1;
  91   1        BUTTON1=1;
  92   1        BUTTON2=1;
  93   1        BUTTON3=1;
  94   1        BUTTON4=1;
  95   1        MOTOR=1;
  96   1        CCON=0;          //PCAåˆå§‹åŒ–
  97   1        CL=0;       //PCAçš„16ä½è®¡æ•°å™¨ä½Žå…«ä½
  98   1        CH=0;       //PCAçš„16ä½è®¡æ•°å™¨é«˜å…«ä½
  99   1        CMOD=0x00; //é€‰æ‹© ç³»ç»Ÿæ—¶é’Ÿ/12 ä¸ºè®¡æ•°è„‰å†²,åˆ™PWMçš„é¢‘çŽ‡f=sysclk/256/12;
 100   1        CCAP0H=0xA0;  //  å ç©ºæ¯”æŽ§åˆ¶
 101   1        CCAP0L=0xA0;
 102   1        PCA_PWM0=0x00; //æŽ§åˆ¶å ç©ºæ¯”çš„ç¬¬ä¹ä½ä¸º0
 103   1        CCAPM0=0x42;  //å…è®¸P13ä½œä¸ºPWMè¾“å‡º
 104   1        CR=1;     //å¯åŠ¨PCAè®¡æ•°å™¨
 105   1        Uart_Two_Init();
 106   1        Uart_One_Init();
 107   1        Init_online();
 108   1        DisplayOneChar(15,0,'N');
 109   1        DisplayListChar(0,1,"T=00 H=00 A=000");
 110   1        P2M1=0x00;
 111   1        P2M0=0x01;
 112   1        fengming();
 113   1        while(1){
 114   2          DisplayListChar(1,0,time);
 115   2          if(MOTOR)
 116   2            DisplayOneChar(10,0,'R');
C51 COMPILER V9.52.0.0   MAIN                                                              05/14/2016 17:58:59 PAGE 3   

 117   2          else
 118   2            DisplayOneChar(10,0,'S');
 119   2          CCAP0H=MOTOR_SPEED*16;
 120   2          CCAP0L=MOTOR_SPEED*16;
 121   2          DisplayOneChar(12,0,MOTOR_SPEED/10);
 122   2          DisplayOneChar(13,0,MOTOR_SPEED%10);
 123   2          RH();
 124   2          DisplayOneChar(2,1,U8T_data_H/10+0x30);
 125   2          DisplayOneChar(3,1,U8T_data_H%10+0x30);
 126   2          DisplayOneChar(7,1,U8RH_data_H/10+0x30);
 127   2          DisplayOneChar(8,1,U8RH_data_H%10+0x30);
 128   2          DisplayOneChar(12,1,(int)PM/100%10+0x30);
 129   2          DisplayOneChar(13,1,(int)PM/10%10+0x30);
 130   2          DisplayOneChar(14,1,(int)PM%10+0x30);
 131   2          if(PM>100.0){
 132   3            MOTOR=1;
 133   3            MOTOR_SPEED=(PM/10)<15?(int)(PM/10):15;
 134   3          }else if(PM<80.0){
 135   3            MOTOR=0;
 136   3            MOTOR_SPEED=10;
 137   3          }
 138   2          Senddata();
 139   2        }
 140   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    726    ----
   CONSTANT SIZE    =     50    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
